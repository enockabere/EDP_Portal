{% extends 'offcanvas.html' %}
{% load bootstrap5 %}
{% load static %}
{% block main %}
<style>
    #loading,
    #result {
        display: none;
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
<section class="dash2">
    <div class="content-wrapper general-bg" style="padding-bottom: 5rem;">
        <div class="row" id="proBanner">
            <div class="col-md-12">
                <span class="d-flex align-items-center purchase-popup">
                    <img src="../../../static/img/logo/fav.png" width="70px" class="img-fluid" alt="" srcset="">
                    <div style="margin-left: auto;margin-right:0;outline: none;border: none;">
                        <h2 class="text-dark font-weight-bold"> Loan Calculator</h2>
                    </div>
                </span>

            </div>
        </div>
        <!--alert -->
        {% include 'alerts.html' %}
        <div class="row">
            <div class="col-md-12">
                <div class="card card-body text-center mt-5">
                    <h1 class="heading display-5 pb-3">Loan Calculator</h1>
                    <form id="loan-form">
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input type="number" class="form-control" id="amount" placeholder="Loan Amount" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">%</span>
                                </div>
                                <input type="number" class="form-control" id="interest" placeholder="Interest" />
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="number" id="years" class="form-control" placeholder="Years To Repay" />
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Calculate" class="btn btn-dark btn-block" />
                        </div>
                    </form>
                    <!-- Loader Here -->
                    <div id="loading">
                        <img src="https://media.giphy.com/media/jAYUbVXgESSti/giphy.gif" alt="" />
                    </div>
                    <!-- Results -->
                    <div id="result">
                        <h5>Results</h5>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Monthly Payment</span>
                                </div>
                                <input type="number" class="form-control" id="monthly-payment" disabled />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Total Payment</span>
                                </div>
                                <input type="number" class="form-control" id="total-payment" disabled />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Total Interest</span>
                                </div>
                                <input type="number" class="form-control" id="total-interest" disabled />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });
    // Listen for Submit
    document.getElementById("loan-form").addEventListener("submit", function (e) {
        // Hide Results
        document.getElementById("result").style.display = "none";

        // Show Loader
        document.getElementById("loading").style.display = "block";

        setTimeout(calculateResults, 2000);

        e.preventDefault();
    });

    // Calculate Results
    function calculateResults() {
        // UI Vars
        const amount = document.getElementById("amount");
        const interest = document.getElementById("interest");
        const years = document.getElementById("years");
        const monthlyPayment = document.getElementById("monthly-payment");
        const totalPayment = document.getElementById("total-payment");
        const totalInterest = document.getElementById("total-interest");

        const principal = parseFloat(amount.value);
        const calculatedInterest = parseFloat(interest.value) / 100 / 12;
        const calculatedPayments = parseFloat(years.value) * 12;

        // Computed Monthly payment
        const x = Math.pow(1 + calculatedInterest, calculatedPayments);
        const monthly = (principal * x * calculatedInterest) / (x - 1);

        if (isFinite(monthly)) {
            monthlyPayment.value = monthly.toFixed(2);
            totalPayment.value = (monthly * calculatedPayments).toFixed(2);
            totalInterest.value = (monthly * calculatedPayments - principal).toFixed(2);

            // Show Results
            document.getElementById("result").style.display = "block";

            // Hide Loader
            document.getElementById("loading").style.display = "none";
        } else {
            showError("Please check number inputs");
        }
    }

    // Show Error
    function showError(error) {
        // Hide Results
        document.getElementById("result").style.display = "none";

        // Hide Loader
        document.getElementById("loading").style.display = "none";

        // Create a div
        const errorDiv = document.createElement("div");

        // Get Elements
        const card = document.querySelector(".card");
        const heading = document.querySelector(".heading");

        // Add class
        errorDiv.className = "alert alert-danger";

        // Create text node and append div
        errorDiv.appendChild(document.createTextNode(error));

        // Insert error above heading
        card.insertBefore(errorDiv, heading);

        // Clear Error after 3 seconds
        setTimeout(clearError, 3000);

        // Clear Error
        function clearError() {
            document.querySelector(".alert").remove();
        }
    }
</script>
{% endblock %}